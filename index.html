<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Nebula Services - Modern Accounts</title>
  <link rel="icon" type="image/png" href="Media/favicon.png">
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700&display=swap" rel="stylesheet">
  <style>
      /* Global Reset & Base Styles */
      * {
          margin: 0;
          padding: 0;
          box-sizing: border-box;
      }

      body {
          font-family: 'Inter', sans-serif;
          background: #0a0a0a; /* Deep dark background */
          color: #e0e0e0; /* Light gray text */
          min-height: 100vh;
          overflow-x: hidden;
          position: relative;
          display: flex;
          flex-direction: column;
      }

      /* Subtle background texture */
      body::before {
          content: '';
          position: fixed;
          top: 0;
          left: 0;
          width: 100%;
          height: 100%;
          background-image: url('data:image/svg+xml,%3Csvg width="6" height="6" viewBox="0 0 6 6" xmlns="http://www.w3.org/2000/svg"%3E%3Cg fill="%231a1a1a" fill-opacity="0.4" fill-rule="evenodd"%3E%3Cpath d="M0 0h3v1H0V0zm0 2h1v3H0V2zm2 0h3v1H2V2zm0 2h1v3H2V4z"/%3E%3C/g%3E%3C/svg%3E');
          opacity: 0.3;
          pointer-events: none;
          z-index: 0;
      }

      .container {
          max-width: 1200px;
          margin: 0 auto;
          padding: 0 20px;
          position: relative;
          z-index: 2;
          flex-grow: 1;
          display: flex;
          flex-direction: column;
      }

      /* Header */
      header {
          padding: 20px 0;
          position: relative;
          z-index: 100;
          border-bottom: 1px solid rgba(255, 255, 255, 0.1);
          box-shadow: 0 2px 15px rgba(0, 0, 0, 0.3);
          margin-bottom: 30px;
          display: grid; /* Use grid for better centering */
          grid-template-columns: 1fr auto 1fr; /* Left nav, centered logo, right empty space */
          align-items: center;
      }

      .header-left-nav {
          display: flex;
          gap: 15px;
          justify-self: start; /* Align to the start of the grid column */
      }

      .nav-item {
          display: flex;
          flex-direction: column;
          align-items: center;
          text-decoration: none;
          color: #b0b0b0;
          font-size: 0.85rem;
          font-weight: 500;
          transition: all 0.2s ease;
          padding: 5px 10px;
          border-radius: 6px;
      }

      .nav-item:hover {
          color: #ffffff;
          background-color: #1a1a1a;
          box-shadow: 0 0 8px rgba(255, 255, 255, 0.1);
      }

      .nav-item svg {
          width: 24px;
          height: 24px;
          margin-bottom: 5px;
          stroke: currentColor;
          stroke-width: 2;
          stroke-linecap: round;
          stroke-linejoin: round;
          fill: none;
      }

      .nav-item.search-toggle-button.active svg {
          transform: rotate(90deg); /* Rotate search icon when active */
      }

      .logo-container {
          display: flex;
          align-items: center;
          gap: 10px;
          justify-self: center; /* Center in the middle grid column */
      }

      .logo-container img {
          width: 50px;
          height: 50px;
          border-radius: 8px;
          box-shadow: 0 0 15px rgba(255, 255, 255, 0.1);
      }

      .logo-container h1 {
          font-family: 'Inter', sans-serif;
          font-size: 2.5rem;
          font-weight: 700;
          color: #ffffff;
          text-shadow: 0 0 15px rgba(255, 255, 255, 0.8); /* Increased glow */
          letter-spacing: -1px;
      }

      /* Dynamic Search and Filter Panel */
      .search-filter-panel {
          background: #1a1a1a;
          border: 1px solid #333333;
          border-radius: 10px;
          padding: 20px;
          margin-bottom: 30px;
          box-shadow: 0 0 15px rgba(0, 0, 0, 0.4);
          display: flex;
          flex-direction: column;
          gap: 20px;
          max-height: 0; /* Initial state for animation */
          opacity: 0;
          overflow: hidden;
          transition: max-height 0.3s ease-out, opacity 0.3s ease-out;
      }

      .search-filter-panel.active {
          max-height: 200px; /* Adjust as needed to fit content */
          opacity: 1;
      }

      .search-input-wrapper {
          display: flex;
          gap: 10px;
          align-items: center;
      }

      .search-filter-panel .search-input {
          flex-grow: 1; /* Take up available space */
          padding: 12px 15px;
          font-size: 0.95rem;
          font-family: 'Inter', sans-serif;
          border: 1px solid #444444;
          border-radius: 6px;
          background: #0f0f0f;
          color: #ffffff;
          box-shadow: inset 0 1px 3px rgba(0, 0, 0, 0.3);
          transition: all 0.2s ease;
          outline: none;
      }

      .search-filter-panel .search-input:focus {
          border-color: #888888;
          box-shadow: 0 0 10px rgba(255, 255, 255, 0.1);
      }

      .filter-toggle-button {
          width: 45px; /* Square button */
          height: 45px;
          background: #0f0f0f;
          border: 1px solid #444444;
          border-radius: 6px;
          cursor: pointer;
          display: flex;
          align-items: center;
          justify-content: center;
          transition: all 0.2s ease;
          color: #b0b0b0;
          box-shadow: inset 0 1px 3px rgba(0, 0, 0, 0.3);
      }

      .filter-toggle-button:hover {
          background: #222222;
          border-color: #888888;
          color: #ffffff;
          box-shadow: 0 0 10px rgba(255, 255, 255, 0.1);
      }

      .filter-toggle-button svg {
          width: 24px;
          height: 24px;
          stroke: currentColor;
          stroke-width: 2;
          stroke-linecap: round;
          stroke-linejoin: round;
          fill: none;
      }

      .filter-options {
          display: none; /* Hidden by default, toggled by JS */
          flex-direction: column;
          gap: 15px;
          padding-top: 10px;
          border-top: 1px solid #222222;
      }

      .filter-options.active {
          display: flex;
      }

      .filter-group {
          display: flex;
          flex-wrap: wrap;
          gap: 15px;
          align-items: center;
      }

      .filter-group label {
          font-size: 0.9rem;
          color: #b0b0b0;
          font-weight: 500;
      }

      .filter-group select {
          padding: 8px 12px;
          border: 1px solid #444444;
          border-radius: 6px;
          background: #0f0f0f;
          color: #ffffff;
          font-family: 'Inter', sans-serif;
          font-size: 0.9rem;
          outline: none;
          cursor: pointer;
          appearance: none; /* Remove default arrow */
          background-image: url('data:image/svg+xml;charset=US-ASCII,%3Csvg%20xmlns%3D%22http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg%22%20width%3D%22292.4%22%20height%3D%22292.4%22%3E%3Cpath%20fill%3D%22%23ffffff%22%20d%3D%22M287%2C114.7L159.3%2C7.7c-3.1-3.1-8.2-3.1-11.3%2C0c-1.6%2C1.6-2.4%2C3.6-2.4%2C5.7v271.9c0%2C4.1%2C3.3%2C7.4%2C7.4%2C7.4c2.1%2C0%2C4.1-0.8%2C5.7-2.4l127.7-107c3.1-3.1%2C3.1-8.2%2C0-11.3C290.1%2C117.8%2C290.1%2C117.8%2C287%2C114.7z%22%2F%3E%3C%2Fsvg%3E');
          background-repeat: no-repeat;
          background-position: right 8px top 50%;
          background-size: 12px auto;
      }

      .filter-group input[type="checkbox"] {
          appearance: none;
          width: 18px;
          height: 18px;
          border: 1px solid #666666;
          border-radius: 4px;
          background-color: #0f0f0f;
          cursor: pointer;
          position: relative;
          top: 2px;
          margin-right: 5px;
      }

      .filter-group input[type="checkbox"]:checked {
          background-color: #ffffff;
          border-color: #ffffff;
      }

      .filter-group input[type="checkbox"]:checked::before {
          content: '✓';
          display: block;
          color: #0a0a0a;
          font-size: 14px;
          line-height: 1;
          text-align: center;
          position: absolute;
          top: 50%;
          left: 50%;
          transform: translate(-50%, -50%);
      }

      /* Accounts Grid */
      .accounts-grid {
          display: grid;
          grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
          gap: 20px;
          padding: 30px 0;
      }

      .account-card {
          background: #1a1a1a;
          border: 1px solid #333333;
          border-radius: 10px;
          padding: 20px;
          transition: all 0.2s ease;
          cursor: pointer;
          position: relative;
          overflow: hidden;
          box-shadow: 0 0 15px rgba(0, 0, 0, 0.4);
      }

      .account-card:hover {
          transform: translateY(-5px);
          border-color: #666666;
          box-shadow: 0 0 20px rgba(255, 255, 255, 0.1);
          background: #222222;
      }

      .account-title {
          font-family: 'Inter', sans-serif;
          font-size: 1.3rem;
          font-weight: 600;
          color: #ffffff;
          margin-bottom: 10px;
          line-height: 1.3;
          min-height: 50px;
          display: flex;
          align-items: center;
      }

      /* Removed from card, now in modal */
      /* .account-description {
          font-family: 'Inter', sans-serif;
          color: #b0b0b0;
          font-size: 0.9rem;
          line-height: 1.5;
          margin-bottom: 15px;
          height: 60px;
          overflow: hidden;
          display: -webkit-box;
          -webkit-line-clamp: 3;
          -webkit-box-orient: vertical;
      } */

      .seller-info {
          display: flex;
          align-items: center;
          gap: 8px;
          margin-bottom: 10px;
      }

      .seller-name {
          font-family: 'Inter', sans-serif;
          color: #e0e0e0;
          font-size: 0.85rem;
          font-weight: 600;
      }

      .verified-badge {
          width: 16px;
          height: 16px;
          background: #555555;
          border-radius: 4px;
          display: flex;
          align-items: center;
          justify-content: center;
          font-size: 10px;
          color: #ffffff;
          font-weight: bold;
      }

      .account-stats {
          display: grid;
          grid-template-columns: repeat(auto-fit, minmax(80px, 1fr)); /* Adjusted for more columns */
          gap: 8px;
          margin-bottom: 15px;
      }

      .stat-item {
          background: #0f0f0f;
          border: 1px solid #222222;
          border-radius: 6px;
          padding: 8px;
          text-align: center;
      }

      .stat-label {
          font-family: 'Inter', sans-serif;
          color: #999999;
          font-size: 0.75rem;
          margin-bottom: 3px;
          text-transform: uppercase;
      }

      .stat-value {
          font-family: 'Inter', sans-serif;
          font-size: 1rem;
          font-weight: 700;
          color: #ffffff;
      }

      .price-section {
          display: flex;
          align-items: center;
          justify-content: space-between;
          padding-top: 15px;
          border-top: 1px solid #333333;
      }

      .price {
          font-family: 'Inter', sans-serif;
          color: #ffffff;
          font-size: 1.8rem;
          font-weight: 700;
          text-shadow: 0 0 5px rgba(255, 255, 255, 0.3);
      }

      /* Removed from card */
      /* .instant-delivery {
          display: flex;
          align-items: center;
          gap: 5px;
          color: #999999;
          font-family: 'Inter', sans-serif;
          font-size: 0.8rem;
          font-weight: 600;
          text-transform: uppercase;
      }

      .instant-icon {
          width: 12px;
          height: 12px;
          background: #666666;
          border-radius: 50%;
      } */

      /* Modal Styles */
      .modal {
          display: none; /* Hidden by default, will be set to 'block' by JS */
          position: fixed;
          z-index: 1000;
          left: 0;
          top: 0;
          width: 100%;
          height: 100%;
          background-color: rgba(0, 0, 0, 0.8);
          backdrop-filter: blur(5px);
      }

      .modal-content {
          background: #1a1a1a;
          border: 1px solid #444444;
          border-radius: 12px;
          /* Centering using absolute positioning and transform */
          position: absolute;
          top: 50%;
          left: 50%;
          transform: translate(-50%, -50%);

          /* Adjusted for near full-page coverage */
          width: 98vw; /* Use viewport width */
          max-width: 1200px; /* Set a reasonable max-width for very large screens */
          height: 98vh; /* Use viewport height */
          max-height: 900px; /* Set a reasonable max-height */
          overflow-y: auto;
          box-shadow: 0 0 25px rgba(0, 0, 0, 0.6);
          margin: 0; /* Remove margin as transform handles centering */
      }

      .modal-header {
          padding: 20px 25px;
          border-bottom: 1px solid #333333;
          display: flex;
          justify-content: space-between;
          align-items: flex-start;
          background: #0f0f0f;
      }

      .modal-title {
          font-family: 'Inter', sans-serif;
          font-size: 1.5rem;
          font-weight: 700;
          color: #ffffff;
          text-shadow: 0 0 8px rgba(255, 255, 255, 0.3);
      }

      .close {
          color: #e0e0e0;
          font-size: 28px;
          font-weight: bold;
          cursor: pointer;
          transition: color 0.2s ease;
          font-family: 'Inter', sans-serif;
      }

      .close:hover {
          color: #ffffff;
          text-shadow: 0 0 10px rgba(255, 255, 255, 0.5);
      }

      .modal-body {
          padding: 25px;
      }

      .modal-description {
          font-family: 'Inter', sans-serif;
          color: #b0b0b0;
          font-size: 1rem;
          line-height: 1.6;
          margin-bottom: 25px;
      }

      .account-details-grid {
          display: grid;
          grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
          gap: 12px;
          margin-bottom: 25px;
      }

      .detail-card {
          background: #0f0f0f;
          border: 1px solid #222222;
          border-radius: 8px;
          padding: 12px;
          text-align: center;
      }

      .detail-label {
          font-family: 'Inter', sans-serif;
          color: #999999;
          font-size: 0.8rem;
          margin-bottom: 5px;
          text-transform: uppercase;
      }

      .detail-value {
          font-family: 'Inter', sans-serif;
          color: #ffffff;
          font-size: 1.1rem;
          font-weight: 600;
      }

      .image-gallery {
          margin-top: 25px;
      }

      .gallery-title {
          font-family: 'Inter', sans-serif;
          color: #ffffff;
          font-size: 1.3rem;
          font-weight: 600;
          margin-bottom: 15px;
          text-shadow: 0 0 8px rgba(255, 255, 255, 0.3);
      }

      .image-grid {
          display: grid;
          grid-template-columns: repeat(auto-fill, minmax(160px, 1fr));
          gap: 12px;
      }

      .gallery-image {
          width: 100%;
          height: 120px;
          object-fit: cover;
          border: 1px solid #444444;
          border-radius: 8px;
          transition: all 0.2s ease;
          cursor: pointer;
          box-shadow: 0 0 10px rgba(0, 0, 0, 0.3);
      }

      .gallery-image:hover {
          border-color: #888888;
          transform: scale(1.03);
          box-shadow: 0 0 15px rgba(255, 255, 255, 0.1);
      }

      .no-results {
          text-align: center;
          padding: 50px 20px;
          color: #b0b0b0;
          font-size: 1.1rem;
          font-family: 'Inter', sans-serif;
      }

      /* Responsive */
      @media (max-width: 768px) {
          header {
              grid-template-columns: 1fr; /* Stack items on small screens */
              gap: 20px;
              padding-bottom: 10px;
          }
          .header-left-nav {
              justify-self: center;
              flex-wrap: wrap;
          }
          .logo-container {
              justify-self: center;
          }
          .logo-container h1 {
              font-size: 2rem;
          }
          .search-filter-panel {
              padding: 15px;
          }
          .accounts-grid {
              grid-template-columns: 1fr;
          }
          .modal-content {
              width: 95vw; /* Adjusted for mobile */
              height: 95vh; /* Adjusted for mobile */
              /* No margin needed here, absolute positioning handles it */
          }
          .modal-header, .modal-body {
              padding: 15px;
          }
          .account-details-grid {
              grid-template-columns: repeat(2, 1fr);
          }
      }

      /* Scrollbar styling */
      ::-webkit-scrollbar {
          width: 10px;
      }

      ::-webkit-scrollbar-track {
          background: #1a1a1a;
      }

      ::-webkit-scrollbar-thumb {
          background: #555555;
          border-radius: 5px;
      }

      ::-webkit-scrollbar-thumb:hover {
          background: #888888;
      }
  </style>
</head>
<body>
<header>
  <div class="header-left-nav">
      <a href="./index.html" class="nav-item">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"></path><polyline points="9 22 9 12 15 12 15 22"></polyline></svg>
          <span>Home</span>
      </a>
      <a href="#" class="nav-item search-toggle-button" id="searchToggleButton">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><circle cx="11" cy="11" r="8"></circle><line x1="21" y1="21" x2="16.65" y2="16.65"></line></svg>
          <span>Search</span>
      </a>
      <a href="./faq.html" class="nav-item">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><circle cx="12" cy="12" r="10"></circle><path d="M9.09 9a3 3 0 0 1 5.83 1c0 2-3 3-3 3"></path><line x1="12" y1="17" x2="12.01" y2="17"></line></svg>
          <span>FAQ</span>
      </a>
  </div>
  <div class="logo-container">
      <img src="Media/favicon.png" alt="NS Logo">
      <h1>Nebula Services</h1>
  </div>
  <div></div> <!-- Empty div to balance flexbox layout -->
</header>

<main>
  <div class="container">
      <!-- Dynamic Search and Filter Panel -->
      <section class="search-filter-panel" id="searchFilterPanel">
          <div class="search-input-wrapper">
              <input type="text" class="search-input" id="dynamicSearchInput" placeholder="Search by title or description...">
              <button class="filter-toggle-button" id="filterToggleButton" style="display: none;">
                  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><circle cx="12" cy="12" r="1"></circle><circle cx="12" cy="5" r="1"></circle><circle cx="12" cy="19" r="1"></circle></svg>
              </button>
          </div>
          <div class="filter-options" id="filterOptions" style="display: none;">
              <div class="filter-group">
                  <label for="sortOrder">Sort By:</label>
                  <select id="sortOrder">
                      <option value="default">Default</option>
                      <option value="price-asc">Price: Low to High</option>
                      <option value="price-desc">Price: High to Low</option>
                  </select>
              </div>
              <div class="filter-group">
                  <label>Tags:</label>
                  <label><input type="checkbox" class="tag-filter" value="stacked"> Stacked</label>
                  <label><input type="checkbox" class="tag-filter" value="og"> OG</label>
              </div>
          </div>
      </section>

      <section class="accounts-section">
          <div class="accounts-grid" id="accountsGrid">
              <!-- Accounts will be dynamically added here -->
          </div>
          <div class="no-results" id="noResults" style="display: none;">
              <h3>No Accounts Found.</h3>
              <p>Adjust your search or check back later for new listings.</p>
          </div>
      </section>
  </div>
</main>

<!-- Modal -->
<div id="accountModal" class="modal">
  <div class="modal-content">
      <div class="modal-header">
          <h2 class="modal-title" id="modalTitle"></h2>
          <span class="close">X</span>
      </div>
      <div class="modal-body">
          <p class="modal-description" id="modalDescription"></p>
          <div class="account-details-grid" id="modalDetails"></div>
          <div class="image-gallery">
              <h3 class="gallery-title">Visual Assets</h3>
              <div class="image-grid" id="imageGallery"></div>
          </div>
      </div>
  </div>
</div>

<script>
  // ACCOUNT DATA
  const accounts = [
      {
          id: 1,
          title: "2 skins | Blue Team Leader | Blue Streak | Wingman | Bogey Bag | Clawz Retro | 600 VB",
          description: "✅ Full Access\n📧 Email Login\n👪 Parental Control: ❌\n🌐 Country: AU\n🔒 2FA Enabled: ❌\n\nhttps://discord.gg/unKSGxun7u",
          seller: "distress",
          price: 7,
          level: 26,
          vbucks: 600,
          skins: 2,
          backpacks: 2,
          pickaxes: 0,
          dances: 0,
          gliders: 1,
          wraps: 1,
          banners: 0,
          sprays: 2,
          exclusives: 2,
          folder: "Media/Accounts/Account 1",
          imageNames: [
              "skins.png",
              "pickaxes.png",
              "emotes.png",
              "exclusives.png"
          ],
          tags: ["rare"]
      },
      {
          id: 2,
          title: "8 skins | Hot Marat | Fresh | Calamity | Drift | DJ Yonder",
          description: "✅ Full Access\n📧 Email Login\n👪 Parental Control: ❌\n🌐 Country: DE\n🔒 2FA Enabled: ❌\n\nhttps://discord.gg/unKSGxun7u",
          seller: "distress",
          price: 20,
          level: 68,
          vbucks: 0,
          skins: 8,
          backpacks: 7,
          pickaxes: 4,
          dances: 11,
          gliders: 7,
          wraps: 1,
          banners: 9,
          sprays: 12,
          exclusives: 2,
          folder: "Media/Accounts/Account 2",
          imageNames: [
              "skins.png",
              "pickaxes.png",
              "emotes.png",
              "exclusives.png"
          ],
          tags: ["og", "rare"]
      },
      {
          id: 3,
          title: "185 skins | Gold Midas | Gold Meowscles | Gold Brutus | Major Glory | Reaper | 3300 VB",
          description: "✅ Full Access\n📧 Email Login\n👪 Parental Control: ✅(Can Be Removed)\n🌐 Country: US\n🔒 2FA Enabled: ✅(Can Be Removed)\n\nhttps://discord.gg/unKSGxun7u",
          seller: "distress",
          price: 40,
          level: 2770,
          vbucks: 3300,
          skins: 185,
          backpacks: 225,
          pickaxes: 194,
          dances: 175,
          gliders: 145,
          wraps: 160,
          banners: 227,
          sprays: 204,
          exclusives: 16,
          folder: "Media/Accounts/Account 3",
          imageNames: [
              "skins.png",
              "pickaxes.png",
              "emotes.png",
              "exclusives.png"
          ],
          tags: ["stacked", "rare"]
      }, // Added missing comma here
      {
          id: 4,
          title: "01 skins | Fresh | Rambunctious | Rogue Agent | Spike | Rust Bucket | 1250 VB",
          description: "✅ Full Access\n📧 Email Login\n👪 Parental Control: ❌\n🌐 Country: DE\n🔒 2FA Enabled: ❌\n\nhttps://discord.gg/unKSGxun7u",
          seller: "distress",
          price: 45,
          level: 1133,
          vbucks: 1250,
          skins: 101,
          backpacks: 92,
          pickaxes: 64,
          dances: 101,
          gliders: 80,
          wraps: 63,
          banners: 153,
          sprays: 156,
          exclusives: 15,
          folder: "Media/Accounts/Account 4",
          imageNames: [
              "skins.png",
              "pickaxes.png",
              "emotes.png",
              "exclusives.png"
          ],
          tags: ["stacked", "rare"]
      }
  ];

  let filteredAccounts = [...accounts];

  // Get elements
  const searchToggleButton = document.getElementById('searchToggleButton');
  const searchFilterPanel = document.getElementById('searchFilterPanel');
  const dynamicSearchInput = document.getElementById('dynamicSearchInput');
  const filterToggleButton = document.getElementById('filterToggleButton');
  const filterOptions = document.getElementById('filterOptions');
  const sortOrderSelect = document.getElementById('sortOrder');
  const tagFilterCheckboxes = document.querySelectorAll('.tag-filter');

  // Initialize the page
  document.addEventListener('DOMContentLoaded', function() {
      displayAccounts();
      
      // Event Listeners for search and filters
      searchToggleButton.addEventListener('click', toggleSearchPanel);
      filterToggleButton.addEventListener('click', toggleFilterOptions);
      dynamicSearchInput.addEventListener('input', searchAccounts);
      sortOrderSelect.addEventListener('change', searchAccounts);
      tagFilterCheckboxes.forEach(checkbox => {
          checkbox.addEventListener('change', searchAccounts);
      });

      // Modal functionality
      const modal = document.getElementById('accountModal');
      const closeBtn = document.querySelector('.close');
      
      closeBtn.onclick = function() {
          modal.style.display = 'none';
      }
      
      window.onclick = function(event) {
          if (event.target == modal) {
              modal.style.display = 'none';
          }
      }
  });

  // Toggle Search Panel
  function toggleSearchPanel() {
      const isActive = searchFilterPanel.classList.toggle('active');
      searchToggleButton.classList.toggle('active');

      if (isActive) {
          filterToggleButton.style.display = 'flex'; // Show the 3-dots button
      } else {
          filterToggleButton.style.display = 'none'; // Hide the 3-dots button
          filterOptions.style.display = 'none'; // Also hide filter options if closing panel
          filterOptions.classList.remove('active'); // Remove active class
      }
  }

  // Toggle Filter Options (3 dots button)
  function toggleFilterOptions() {
      filterOptions.classList.toggle('active');
      if (filterOptions.classList.contains('active')) {
          filterOptions.style.display = 'flex';
      } else {
          filterOptions.style.display = 'none';
      }
  }

  // Display accounts
  function displayAccounts() {
      const grid = document.getElementById('accountsGrid');
      const noResults = document.getElementById('noResults');
      
      if (filteredAccounts.length === 0) {
          grid.style.display = 'none';
          noResults.style.display = 'block';
          return;
      }
      
      grid.style.display = 'grid';
      noResults.style.display = 'none';
      
      grid.innerHTML = filteredAccounts.map(account => `
          <div class="account-card" onclick="openModal(${account.id})">
              <div class="account-title">
                  ${account.title}
              </div>
              
              <div class="seller-info">
                  <span class="seller-name">${account.seller}</span>
                  <div class="verified-badge">✓</div>
              </div>
              
              <div class="account-stats">
                  <div class="stat-item">
                      <div class="stat-label">ACCOUNT LVL</div>
                      <div class="stat-value">${account.level}</div>
                  </div>
                  <div class="stat-item">
                      <div class="stat-label">V-Bucks</div>
                      <div class="stat-value">${account.vbucks.toLocaleString()}</div>
                  </div>
                  <div class="stat-item">
                      <div class="stat-label">Skins</div>
                      <div class="stat-value">${account.skins}</div>
                  </div>
              </div>
              
              <div class="price-section">
                  <span class="price">$${account.price.toFixed(2)}</span>
              </div>
          </div>
      `).join('');
  }

  // Search and Filter accounts
  function searchAccounts() {
      const searchTerm = dynamicSearchInput.value.toLowerCase().trim();
      const sortOrder = sortOrderSelect.value;
      const selectedTags = Array.from(tagFilterCheckboxes)
                              .filter(checkbox => checkbox.checked)
                              .map(checkbox => checkbox.value);

      let tempAccounts = [...accounts];

      // Apply search filter
      if (searchTerm !== '') {
          tempAccounts = tempAccounts.filter(account => 
              account.title.toLowerCase().includes(searchTerm) || 
              account.description.toLowerCase().includes(searchTerm)
          );
      }

      // Apply tag filters
      if (selectedTags.length > 0) {
          tempAccounts = tempAccounts.filter(account => 
              selectedTags.every(tag => account.tags && account.tags.includes(tag))
          );
      }

      // Apply sorting
      if (sortOrder === 'price-asc') {
          tempAccounts.sort((a, b) => a.price - b.price);
      } else if (sortOrder === 'price-desc') {
          tempAccounts.sort((a, b) => b.price - a.price);
      }
      // 'default' or no selection means no specific sort is applied beyond initial order

      filteredAccounts = tempAccounts;
      displayAccounts();
  }

  // Open modal with account details
  function openModal(accountId) {
      const account = accounts.find(acc => acc.id === accountId);
      if (!account) return;

      const modal = document.getElementById('accountModal');
      const modalTitle = document.getElementById('modalTitle');
      const modalDescription = document.getElementById('modalDescription');
      const modalDetails = document.getElementById('modalDetails');
      const imageGalleryContainer = document.querySelector('.image-gallery');
      const imageGalleryGrid = document.getElementById('imageGallery');

      modalTitle.textContent = account.title;
      modalDescription.innerHTML = account.description.replace(/\n/g, '<br>');

      modalDetails.innerHTML = `
          <div class="detail-card">
              <div class="detail-label">Account ID</div>
              <div class="detail-value">#${account.id.toString().padStart(3, '0')}</div>
          </div>
          <div class="detail-card">
              <div class="detail-label">ACCOUNT LVL</div>
              <div class="detail-value">${account.level}</div>
          </div>
          <div class="detail-card">
              <div class="detail-label">V-Bucks</div>
              <div class="detail-value">${account.vbucks.toLocaleString()}</div>
          </div>
          <div class="detail-card">
              <div class="detail-label">Skins</div>
              <div class="detail-value">${account.skins}</div>
          </div>
          <div class="detail-card">
              <div class="detail-label">Backpacks</div>
              <div class="detail-value">${account.backpacks}</div>
          </div>
          <div class="detail-card">
              <div class="detail-label">Pickaxes</div>
              <div class="detail-value">${account.pickaxes}</div>
          </div>
          <div class="detail-card">
              <div class="detail-label">Dances</div>
              <div class="detail-value">${account.dances}</div>
          </div>
          <div class="detail-card">
              <div class="detail-label">Gliders</div>
              <div class="detail-value">${account.gliders}</div>
          </div>
          <div class="detail-card">
              <div class="detail-label">Wraps</div>
              <div class="detail-value">${account.wraps}</div>
          </div>
          <div class="detail-card">
              <div class="detail-label">Banners</div>
              <div class="detail-value">${account.banners}</div>
          </div>
          <div class="detail-card">
              <div class="detail-label">Sprays</div>
              <div class="detail-value">${account.sprays}</div>
          </div>
          <div class="detail-card">
              <div class="detail-label">Exclusives</div>
              <div class="detail-value">${account.exclusives}</div>
          </div>
          <div class="detail-card">
              <div class="detail-label">Price</div>
              <div class="detail-value">$${account.price.toFixed(2)}</div>
          </div>
      `;

      const imagePaths = account.imageNames.map(imageName => `${account.folder}/${imageName}`);
      
      imageGalleryContainer.style.display = 'block'; 

      imageGalleryGrid.innerHTML = imagePaths.map(imagePath => `
          <img src="${imagePath}" alt="Account Screenshot" class="gallery-image" onclick="window.open('${imagePath}', '_blank')" onerror="this.remove()">
      `).join('');

      modal.style.display = 'block'; // This will now correctly show the modal
  }
</script>
</body>
</html>
